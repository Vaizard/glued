var Authenticator;(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};(()=>{e.d(t,{default:()=>s});class o{static getAccessToken(){return localStorage.getItem("access_token")}static getRefreshToken(){return localStorage.getItem("refresh_token")}static getIDToken(){return localStorage.getItem("id_token")}static setAccessToken(e){localStorage.setItem("access_token",e)}static setRefreshToken(e){localStorage.setItem("refresh_token",e)}static setIDToken(e){localStorage.setItem("id_token",e)}static generateVerifierChallenge(){return crypto.randomBytes(32).toString("hex")}static getVerifierToken(){let e=localStorage.getItem("verifier_token");return e||(e=o.generateVerifierChallenge(),localStorage.setItem("verifier_token",e)),e}}class r{static saveState(e,t){localStorage.setItem("state_"+e,t)}static popState(e){let t=localStorage.getItem("state_"+e);return localStorage.removeItem("state_"+e),t}}class a{constructor(e){this.message=e,this.name="AuthenticationException"}}const s=class{constructor(e){if(!e?.tokenEndpoint)throw"At least refresh_uri is required";this.options=e}authenticatedFetch=async(e,t)=>{t=this.injectBearer(t),console.log(t),t.mode="cors";let o=await fetch(e,t);return 403!==o.status&&401!==o.status||(await this.refreshTokens(),t=this.injectBearer(t),o=await fetch(e,t)),o};injectBearer(e){e||(e={});let t=o.getAccessToken();return t?(e.headers||(e.headers={}),e.headers.Authorization="Bearer "+t,e):e}refreshTokens=async()=>{let e=await fetch(this.options.tokenEndpoint,{body:new URLSearchParams({client_id:this.options.clientId,refresh_token:o.getRefreshToken(),grant_type:"refresh_token"}),headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"});await this.handleCodeResponse(e)};getRedirectUri=()=>this.options.redirectUri??window.location;createState=()=>{let e=Math.floor(1e6*Math.random());return r.saveState(e,this.getRedirectUri()),e};initiateLogin=()=>{let e=new URLSearchParams({client_id:this.options.clientId,redirect_uri:this.getRedirectUri(),response_type:"code",state:this.createState(),scope:this.options?.scope??"openid"});window.location=this.options.authorizationEndpoint+"?"+e};checkLogin=async()=>{let e=new URLSearchParams(window.location.search);if(e.has("code")){let t=await fetch(this.options.tokenEndpoint,{body:new URLSearchParams({client_id:this.options.clientId,code:e.get("code"),grant_type:"authorization_code",redirect_uri:r.popState(e.get("state"))}),headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"}),o=await this.handleCodeResponse(t);return this.removeAuthUrlParameters(),{success:!0,...o}}return{success:!1}};handleCodeResponse=async e=>{if(e.ok){let t=await e.json();return o.setAccessToken(t.access_token),o.setRefreshToken(t.refresh_token),t.id_token&&o.setIDToken(t.id_token),{accessToken:t.access_token,refreshToken:t.refresh_token}}{let t=await e.text();throw console.error(t),new a(t)}};removeAuthUrlParameters=()=>{let e=new URL(window.location);e.searchParams.delete("state"),e.searchParams.delete("code"),history.replaceState(null,"",e.href)}}})(),Authenticator=t.default})();